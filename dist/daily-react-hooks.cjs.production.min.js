"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("@daily-co/daily-js")),n=require("react"),r=e(n),i=require("recoil"),a=e(require("lodash.throttle"));function u(e,t,n,r,i,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,i)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){u(a,r,i,o,c,"next",e)}function c(e){u(a,r,i,o,c,"throw",e)}o(void 0)}))}}function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=n.createContext(null),d=n.createContext({on:function(){},off:function(){}}),f=function(){return n.useContext(s)},v=0,p=function(){return v++},g=function(e,t){var r=n.useContext(d),i=r.off,a=r.on,u=n.useState(!1),o=u[0],c=u[1],l=n.useRef(0),s=n.useMemo((function(){return p()}),[]);n.useEffect((function(){if(e&&!o){if(l.current>1e5)return console.error("useDailyEvent called with potentially non-memoized event callback or due to too many re-renders.\n        Memoize using useCallback to avoid re-render loop or reduce the amount of state transitions the callback depends on.\n        Passed callback for '"+e+"' event is NOT registered.",t),void c(!0);l.current++;var n=setTimeout((function(){l.current=0}),50);return a(e,t,s),function(){clearTimeout(n),i(e,s)}}}),[t,e,s,o,i,a])},m=function(e,t,r){void 0===r&&(r=100);var i=n.useContext(d),u=i.off,o=i.on,c=n.useMemo((function(){return p()}),[]),l=n.useRef([]),s=n.useMemo((function(){return a((function(){0!==l.current.length&&(t(l.current),l.current=[])}),r,{trailing:!0})}),[t,r]);n.useEffect((function(){if(e)return o(e,(function(e){l.current.push(e),setTimeout(s,0)}),c),function(){u(e,c)}}),[s,e,c,u,o])},k=i.atom({key:"local-id",default:""}),b=i.atom({key:"participants-objects",default:[]}),y=i.selectorFamily({key:"participant",get:function(e){return function(t){var n;return null!=(n=(0,t.get)(b).find((function(t){return t.session_id===e})))?n:null}}}),h=i.selectorFamily({key:"participant-property",get:function(e){var t=e.id,n=e.property;return function(e){var r,i=null!=(r=(0,e.get)(b).find((function(e){return e.session_id===t})))?r:null;return i?function(e,t){return t.split(".").reduce((function(e,t){return null==e?void 0:e[t]}),e)}(i,n):null}}}),R=function(e){var t=e.children,a=f();g("active-speaker-change",i.useRecoilCallback((function(e){var t=e.set,n=e.snapshot;return function(){var e=o((function*(e){var r=e.activeSpeaker.peerId,i=yield n.getPromise(y(r));!i&&a&&(i=a.participants()[r]),i&&t(b,(function(e){return[].concat(e).map((function(e){return e.session_id===r?c({},e,{last_active:new Date}):e}))}))}));return function(t){return e.apply(this,arguments)}}()}),[a]));var u=i.useRecoilCallback((function(e){var t=e.set;return function(){var e=o((function*(e){t(k,e.local.session_id),t(b,Object.values(e))}));return function(t){return e.apply(this,arguments)}}()}),[]);n.useEffect((function(){if(a){var e=setInterval((function(){var t=a.participants();"local"in t&&(u(t),clearInterval(e))}),100);return function(){clearInterval(e)}}}),[a,u]);var l=n.useCallback((function(){if(a){var e=null==a?void 0:a.participants();e.local&&u(e)}}),[a,u]);return g("started-camera",l),g("access-state-updated",l),g("joining-meeting",l),g("joined-meeting",n.useCallback((function(e){u(e.participants)}),[u])),m("participant-joined",i.useRecoilCallback((function(e){var t=e.set;return function(){var e=o((function*(e){e.length&&t(b,(function(t){return[].concat(t,e.map((function(e){return e.participant}))).filter((function(e,t,n){return n.findIndex((function(t){return t.session_id===e.session_id}))==t}))}))}));return function(t){return e.apply(this,arguments)}}()}),[])),m("participant-updated",i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){var n=t.set;e.forEach((function(e){var t=e.participant;n(b,(function(e){return[].concat(e).map((function(e){return e.session_id===t.session_id?t:e}))}))}))}))}}),[])),m("participant-left",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(b,(function(t){return[].concat(t).filter((function(t){return!e.some((function(e){return e.participant.session_id===t.session_id}))}))}))}}),[])),g("left-meeting",i.useRecoilCallback((function(e){var t=e.reset;return function(){t(k),t(b)}}),[])),r.createElement(r.Fragment,null,t)},S=i.atom({key:"room",default:null}),C=function(e){var t=e.children,n=f(),a=i.useRecoilCallback((function(e){var t=e.set;return o((function*(){if(n&&"left-meeting"!==n.meetingState()){var e=yield n.room();return e&&"id"in e&&t(S,e),e}}))}),[n]);return g("access-state-updated",a),r.createElement(r.Fragment,null,t)},T=["children"],E=function(e,t){var r=void 0===t?{}:t,a=r.onParticipantLeft,u=r.onParticipantUpdated,o=i.useRecoilValue(y(e));return m("participant-updated",n.useCallback((function(t){var n=t.filter((function(t){return t.participant.session_id===e}));n.length&&n.forEach((function(e){setTimeout((function(){return null==u?void 0:u(e)}),0)}))}),[u,e])),m("participant-left",n.useCallback((function(t){if(t.filter((function(t){return t.participant.session_id===e})).length){var n=t[t.length-1];setTimeout((function(){return null==a?void 0:a(n)}),0)}}),[a,e])),o},I=i.atom({key:"active-id",default:""}),_=i.atomFamily({key:"media-track",default:{state:"loading",subscribed:!1}}),w=function(e,t){void 0===t&&(t="video");var r=f(),a=n.useMemo((function(){return e+"-"+t}),[e,t]),u=i.useRecoilValue(_(a)),o=i.useRecoilCallback((function(n){var r=n.transact_UNSTABLE;return function(n){var i=n.filter((function(t){return t.participant.session_id===e}));i.length&&r((function(e){var n=e.reset,r=e.set;i.forEach((function(e){switch(e.action){case"participant-joined":case"participant-updated":r(_(a),e.participant.tracks[t]);break;case"participant-left":n(_(a))}}))}))}}),[a,e,t]);m("participant-joined",o),m("participant-updated",o),m("participant-left",o),g("joined-meeting",i.useRecoilCallback((function(e){var n=e.set;return function(e){n(_(a),e.participants.local.tracks[t])}}),[a,t]));var l=i.useRecoilCallback((function(e){var t=e.set;return function(e){e&&t(_(a),e)}}),[a]);return n.useEffect((function(){var n,i;if(r){var a=null==r?void 0:r.participants();if(a){var u=Object.values(a).find((function(t){return t.session_id===e}));u&&l(null!=(n=null==(i=u.tracks)?void 0:i[t])?n:null)}}}),[r,e,l,t]),u?c({},u,{isOff:"blocked"===u.state||"off"===u.state}):{isOff:!0,persistentTrack:void 0,state:"off",subscribed:!1}},A=i.atom({key:"general-camera-state",default:"pending"}),L=i.atom({key:"general-microphone-state",default:"pending"}),P=i.atom({key:"camera-devices",default:[]}),j=i.atom({key:"microphone-devices",default:[]}),x=i.atom({key:"speaker-devices",default:[]}),O=i.atom({key:"input-settings",default:null}),D=i.atom({key:"input-settings-error",default:null}),V=i.atom({key:"live-streaming",default:{errorMsg:void 0,isLiveStreaming:!1,layout:void 0}}),M=function(){return i.useRecoilValue(k)||null},U=i.atom({key:"topology",default:"peer"}),B=i.atom({key:"networkQuality",default:100}),N=i.atom({key:"networkThreshold",default:"good"}),q=Boolean,F=function(){return 0},W=function(e){var t=void 0===e?{filter:q,sort:F}:e,r=t.filter,a=void 0===r?q:r,u=t.onActiveSpeakerChange,c=t.onParticipantJoined,l=t.onParticipantLeft,s=t.onParticipantUpdated,d=t.sort,f=void 0===d?F:d,v=i.useRecoilValue(b),p=n.useMemo((function(){var e,t=q;switch(a){case"local":t=function(e){return e.local};break;case"owner":t=function(e){return e.owner};break;case"record":t=function(e){return e.record};break;case"remote":t=function(e){return!e.local};break;case"screen":t=function(e){return e.screen};break;default:t=a}switch(f){case"joined_at":case"session_id":case"user_id":case"user_name":e=function(e,t){return e[f]<t[f]?-1:e[f]>t[f]?1:0};break;default:e=f}return v.filter(t).sort(e).map((function(e){return e.session_id})).filter(Boolean)}),[v,a,f]);return m("participant-joined",n.useCallback((function(e){e.length&&e.forEach((function(e){return setTimeout((function(){return null==c?void 0:c(e)}),0)}))}),[c])),m("participant-updated",n.useCallback((function(e){e.length&&e.forEach((function(e){return setTimeout((function(){return null==s?void 0:s(e)}),0)}))}),[s])),m("active-speaker-change",n.useCallback(function(){var e=o((function*(e){e.length&&e.forEach((function(e){return setTimeout((function(){return null==u?void 0:u(e)}),0)}))}));return function(t){return e.apply(this,arguments)}}(),[u])),m("participant-left",n.useCallback((function(e){e.length&&e.forEach((function(e){return setTimeout((function(){return null==l?void 0:l(e)}),0)}))}),[l])),p},z=i.atomFamily({key:"participant-receive-settings",default:{}}),Q=i.atom({key:"recording",default:{isLocalParticipantRecorded:!1,isRecording:!1}}),J=i.atom({key:"waiting-participants",default:[]}),$=i.atomFamily({key:"waiting-participant",default:{awaitingAccess:{level:"full"},id:"",name:""}}),G=i.selector({key:"waitingParticipantsSelector",get:function(e){var t=e.get;return t(J).map((function(e){return t($(e))}))}});exports.DailyProvider=function(e){var a=e.children,u=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t.indexOf(n=a[r])>=0||(i[n]=e[n]);return i}(e,T),o=n.useState("callObject"in u?u.callObject:null),c=o[0],f=o[1],v=n.useRef({});n.useEffect((function(){var e;"callObject"in u&&c&&u.callObject&&(null==c?void 0:c._callFrameId)!==(null==u||null==(e=u.callObject)?void 0:e._callFrameId)&&f(u.callObject)}),[c,u]);var p=n.useCallback((function(e){if("action"in e)for(var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,void 0):void 0}}(e))){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(null!=(r=null==(i=v.current)||null==(a=i[e.action])?void 0:a.values())?r:[]);!(t=n()).done;){var r,i,a;(0,t.value)(e)}}),[]),g=n.useCallback((function(e){e&&Object.keys(v.current).forEach((function(t){e.off(t,p).on(t,p)}))}),[p]);n.useEffect((function(){if(!c){if("callObject"in u)return f(u.callObject),void g(u.callObject);var e=t.createCallObject(u);f(e),g(e)}}),[c,g,u]);var m=n.useCallback((function(e,t,n){var r,i;v.current[e]||(v.current[e]=new Map,c&&c.off(e,p).on(e,p)),null!=(r=v.current[e])&&r.has(n)||null==(i=v.current[e])||i.set(n,t)}),[c,p]),k=n.useCallback((function(e,t){var n,r;null==(n=v.current[e])||n.delete(t),0===(null==(r=v.current[e])?void 0:r.size)&&(null==c||c.off(e,p),delete v.current[e])}),[c,p]);return r.createElement(i.RecoilRoot,null,r.createElement(s.Provider,{value:c},r.createElement(d.Provider,{value:{on:m,off:k}},r.createElement(C,null,r.createElement(R,null,a)))))},exports.useActiveParticipant=function(e){var t=void 0===e?{}:e,r=t.ignoreLocal,a=void 0!==r&&r,u=t.onActiveSpeakerChange,o=f(),c=i.useRecoilValue(I),l=n.useState(""),s=l[1],d=E(l[0]);return n.useEffect((function(){var e;if(o){var t=null==o||null==(e=o.participants())?void 0:e.local;a&&c===(null==t?void 0:t.session_id)||s(c)}}),[o,a,c]),g("active-speaker-change",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(I,e.activeSpeaker.peerId),setTimeout((function(){return null==u?void 0:u(e)}),0)}}),[u])),d},exports.useAppMessage=function(e){var t=(void 0===e?{}:e).onAppMessage,r=f(),i=n.useCallback((function(e,t){void 0===t&&(t="*"),r&&r.sendAppMessage(e,t)}),[r]),a=n.useCallback((function(e){null==t||t(e,i)}),[t,i]);return g("app-message",a),i},exports.useAudioTrack=function(e){return w(e,"audio")},exports.useDaily=f,exports.useDailyEvent=g,exports.useDevices=function(){var e=f(),t=i.useRecoilValue(A),r=i.useRecoilValue(L),a=i.useRecoilValue(P),u=i.useRecoilValue(j),l=i.useRecoilValue(x),s=i.useRecoilCallback((function(t){var n=t.transact_UNSTABLE;return o((function*(){var t,r,i,a;if(void 0!==(null==(t=navigator)||null==(r=t.mediaDevices)?void 0:r.getUserMedia)&&void 0!==(null==(i=navigator)||null==(a=i.mediaDevices)?void 0:a.enumerateDevices)){if(e)try{var u=(yield e.enumerateDevices()).devices,o=u.filter((function(e){return"videoinput"===e.kind&&""!==e.deviceId})),c=u.filter((function(e){return"audioinput"===e.kind&&""!==e.deviceId})),l=u.filter((function(e){return"audiooutput"===e.kind&&""!==e.deviceId})),s=yield e.getInputDevices(),d=s.camera,f=s.mic,v=s.speaker,p=function(e,t,n){var r,i;return{device:t,selected:"deviceId"in e&&t.deviceId===e.deviceId,state:null!=(r=null==(i=n.find((function(e){return e.device.deviceId===t.deviceId})))?void 0:i.state)?r:"granted"}},g=function(e,t){return"default"===e.device.deviceId?-1:"default"===t.device.deviceId?1:e.device.label<t.device.label?-1:e.device.label>t.device.label?1:0};n((function(e){var t=e.set;t(P,(function(e){return o.filter(Boolean).map((function(t){return p(d,t,e)})).sort(g)})),t(j,(function(e){return c.filter(Boolean).map((function(t){return p(f,t,e)})).sort(g)})),t(x,(function(e){return l.filter(Boolean).map((function(t){return p(v,t,e)})).sort(g)}))}))}catch(e){n((function(e){var t=e.set;t(A,"not-supported"),t(L,"not-supported")}))}}else n((function(e){var t=e.set;t(A,"not-supported"),t(L,"not-supported")}))}))}),[e]),d=i.useRecoilCallback((function(t){var n=t.set,r=t.snapshot,i=t.transact_UNSTABLE;return o((function*(){var t,a,u,o,l,d,f,v,p,g,m,k;if(e){var b=yield r.getPromise(A),y=yield r.getPromise(L),h=e.participants().local.tracks,R="pending"===b&&"interrupted"===h.video.state,S="pending"===y&&"interrupted"===h.audio.state;null!=(t=h.audio)&&null!=(a=t.blocked)&&a.byDeviceInUse?i((function(e){var t=e.set;t(L,"in-use"),t(j,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"in-use"}):e}))}))})):null!=(u=h.audio)&&null!=(o=u.blocked)&&o.byDeviceMissing?n(L,"not-found"):null!=(l=h.audio)&&null!=(d=l.blocked)&&d.byPermissions?n(L,"blocked"):S||i((function(e){var t=e.set;t(L,"granted"),t(j,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"granted"}):e}))}))})),null!=(f=h.video)&&null!=(v=f.blocked)&&v.byDeviceInUse?i((function(e){var t=e.set;t(A,"in-use"),t(P,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"in-use"}):e}))}))})):null!=(p=h.video)&&null!=(g=p.blocked)&&g.byDeviceMissing?n(A,"not-found"):null!=(m=h.video)&&null!=(k=m.blocked)&&k.byPermissions?n(A,"blocked"):R||i((function(e){var t=e.set;t(A,"granted"),t(P,(function(e){return e.map((function(e){return e.selected?c({},e,{state:"granted"}):e}))}))})),s()}}))}),[e,s]);g("participant-updated",n.useCallback((function(e){e.participant.local&&d()}),[d])),g("available-devices-updated",s),g("camera-error",i.useRecoilCallback((function(e){var t=e.set,n=e.transact_UNSTABLE;return function(e){var r=e.error,i=e.errorMsg,a=i.audioOk,u=i.errorMsg,o=i.videoOk;switch(null==r?void 0:r.type){case"cam-in-use":t(A,"in-use");break;case"mic-in-use":t(L,"in-use");break;case"cam-mic-in-use":n((function(e){var t=e.set;t(A,"in-use"),t(L,"in-use")}));break;default:switch(u){case"devices error":n((function(e){var t=e.set;o||t(A,"not-found"),a||t(L,"not-found")}));break;case"not allowed":n((function(e){var t=e.set;t(A,"blocked"),t(L,"blocked")})),d()}}}}),[d])),g("error",i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){switch(e.errorMsg){case"not allowed":t((function(e){var t=e.set;t(A,"blocked"),t(L,"blocked")})),d()}}}),[d])),g("started-camera",i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(){t((function(e){var t=e.set;t(A,"granted"),t(L,"granted")})),d()}}),[d]));var v=n.useCallback(function(){var t=o((function*(t){yield null==e?void 0:e.setInputDevicesAsync({audioDeviceId:null,videoDeviceId:t}),s()}));return function(e){return t.apply(this,arguments)}}(),[e,s]),p=n.useCallback(function(){var t=o((function*(t){yield null==e?void 0:e.setInputDevicesAsync({audioDeviceId:t,videoDeviceId:null}),s()}));return function(e){return t.apply(this,arguments)}}(),[e,s]),m=n.useCallback(function(){var t=o((function*(t){yield null==e?void 0:e.setOutputDeviceAsync({outputDeviceId:t}),s()}));return function(e){return t.apply(this,arguments)}}(),[e,s]);return{cameras:a,camState:t,hasCamError:["blocked","in-use","not-found"].includes(t),hasMicError:["blocked","in-use","not-found"].includes(r),microphones:u,micState:r,refreshDevices:s,setCamera:v,setMicrophone:p,setSpeaker:m,speakers:l}},exports.useInputSettings=function(e){var t=void 0===e?{}:e,r=t.onError,a=t.onInputSettingsUpdated,u=i.useRecoilValue(O),o=i.useRecoilValue(D),c=f(),l=i.useRecoilCallback((function(e){var t=e.set;return function(e){t(O,e)}}),[]);return n.useEffect((function(){c&&c.getInputSettings().then(l)}),[c,l]),g("input-settings-updated",n.useCallback((function(e){l(e.inputSettings),setTimeout((function(){return null==a?void 0:a(e)}),0)}),[a,l])),g("nonfatal-error",i.useRecoilCallback((function(e){var t=e.set;return function(e){"input-settings-error"===e.type&&(t(D,e.errorMsg),setTimeout((function(){return null==r?void 0:r(e)}),0))}}),[r])),{errorMsg:o,inputSettings:u,updateInputSettings:n.useCallback((function(e){null==c||c.updateInputSettings(e)}),[c])}},exports.useLiveStreaming=function(e){var t=void 0===e?{}:e,r=t.onLiveStreamingError,a=t.onLiveStreamingStarted,u=t.onLiveStreamingStopped,o=f(),l=i.useRecoilValue(V);return g("live-streaming-started",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(V,{isLiveStreaming:!0,layout:null==e?void 0:e.layout}),setTimeout((function(){return null==a?void 0:a(e)}),0)}}),[a])),g("live-streaming-stopped",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(V,(function(e){return c({},e,{isLiveStreaming:!1,layout:void 0})})),setTimeout((function(){return null==u?void 0:u(e)}),0)}}),[u])),g("live-streaming-error",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(V,(function(t){return c({},t,{errorMsg:e.errorMsg})})),setTimeout((function(){return null==r?void 0:r(e)}),0)}}),[r])),c({},l,{startLiveStreaming:n.useCallback((function(e){o&&o.startLiveStreaming(e)}),[o]),stopLiveStreaming:n.useCallback((function(){o&&o.stopLiveStreaming()}),[o]),updateLiveStreaming:n.useCallback((function(e){o&&o.updateLiveStreaming({layout:e.layout})}),[o])})},exports.useLocalParticipant=function(){var e=i.useRecoilValue(k);return E(e)},exports.useLocalSessionId=M,exports.useMediaTrack=w,exports.useNetwork=function(e){var t=void 0===e?{}:e,r=t.onNetworkConnection,a=t.onNetworkQualityChange,u=f(),c=i.useRecoilValue(U),l=i.useRecoilValue(B),s=i.useRecoilValue(N),d=i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){var n=t.set;switch(e.event){case"connected":"peer-to-peer"===e.type&&n(U,"peer"),"sfu"===e.type&&n(U,"sfu")}})),setTimeout((function(){return null==r?void 0:r(e)}),0)}}),[r]),v=i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){var n=t.set;n(B,(function(t){return t!==e.quality?e.quality:t})),n(N,(function(t){return t!==e.threshold?e.threshold:t}))})),setTimeout((function(){return null==a?void 0:a(e)}),0)}}),[a]);return g("network-connection",d),g("network-quality-change",v),{getStats:n.useCallback(o((function*(){var e=yield null==u?void 0:u.getNetworkStats();return null==e?void 0:e.stats})),[u]),quality:l,threshold:s,topology:c}},exports.useParticipant=E,exports.useParticipantIds=W,exports.useParticipantProperty=function(e,t){return i.useRecoilValue(h({id:e,property:t}))},exports.useReceiveSettings=function(e){var t=void 0===e?{}:e,r=t.id,a=void 0===r?"base":r,u=t.onReceiveSettingsUpdated,o=i.useRecoilValue(z("base")),l=i.useRecoilValue(z(a)),s=f();g("receive-settings-updated",i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){for(var n=t.reset,r=t.set,i=c({},e.receiveSettings),u=0,o=Object.entries(i);u<o.length;u++){var l=o[u],s=l[1];r(z(l[0]),s)}a in i||n(z(a))})),setTimeout((function(){return null==u?void 0:u(e)}),0)}}),[a,u]));var d=n.useCallback((function(e){s&&"joined-meeting"===s.meetingState()&&(null==s||null==s.updateReceiveSettings||s.updateReceiveSettings(e))}),[s]);return{receiveSettings:"base"===a||0===Object.keys(l).length?o:l,updateReceiveSettings:d}},exports.useRecording=function(e){var t=void 0===e?{}:e,r=t.onRecordingData,a=t.onRecordingError,u=t.onRecordingStarted,o=t.onRecordingStopped,l=f(),s=i.useRecoilValue(Q),d=i.useSetRecoilState(Q),v=M(),p=W({filter:"record"});return n.useEffect((function(){var e=p.length>0,t=p.includes(null!=v?v:"local");d((function(n){return c({},n,{isLocalParticipantRecorded:"local"!==(null==n?void 0:n.type)&&null!=n&&n.type?n.isLocalParticipantRecorded:e,isRecording:"local"!==(null==n?void 0:n.type)&&null!=n&&n.type?n.isRecording:e,local:"local"!==(null==n?void 0:n.type)&&null!=n&&n.type||!e?null==n?void 0:n.local:t,type:e?"local":null==n?void 0:n.type})}))}),[v,p,d]),g("recording-started",i.useRecoilCallback((function(e){var t=e.set;return function(e){var n=!0;switch(e.type){case"cloud-beta":case"cloud":var r;v&&"single-participant"===(null==(r=e.layout)?void 0:r.preset)&&e.layout.session_id!==v&&(n=!1)}t(Q,{error:!1,isLocalParticipantRecorded:n,isRecording:!0,layout:null==e?void 0:e.layout,local:null==e?void 0:e.local,recordingId:null==e?void 0:e.recordingId,recordingStartedDate:new Date,startedBy:null==e?void 0:e.startedBy,type:null==e?void 0:e.type}),setTimeout((function(){return null==u?void 0:u(e)}),0)}}),[v,u])),g("recording-stopped",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(Q,(function(e){return c({},e,{isLocalParticipantRecorded:!1,isRecording:!1})})),setTimeout((function(){return null==o?void 0:o(e)}),0)}}),[o])),g("recording-error",i.useRecoilCallback((function(e){var t=e.set;return function(e){t(Q,(function(e){return c({},e,{error:!0,isLocalParticipantRecorded:!1,isRecording:!1})})),setTimeout((function(){return null==a?void 0:a(e)}),0)}}),[a])),g("recording-data",n.useCallback((function(e){null==r||r(e)}),[r])),c({},s,{startRecording:n.useCallback((function(e){l&&l.startRecording(e)}),[l]),stopRecording:n.useCallback((function(){l&&l.stopRecording()}),[l]),updateRecording:n.useCallback((function(e){l&&l.updateRecording(e)}),[l])})},exports.useRoom=function(){return i.useRecoilValue(S)},exports.useScreenAudioTrack=function(e){return w(e,"screenAudio")},exports.useScreenShare=function(e){var t=void 0===e?{}:e,r=t.onLocalScreenShareStarted,i=t.onLocalScreenShareStopped,a=f(),u=n.useCallback((function(e){null==a||a.startScreenShare(e)}),[a]),o=n.useCallback((function(){null==a||a.stopScreenShare()}),[a]);g("local-screen-share-started",n.useCallback((function(){return null==r?void 0:r()}),[r])),g("local-screen-share-stopped",n.useCallback((function(){return null==i?void 0:i()}),[i]));var c=W({filter:"screen"}),l=n.useMemo((function(){return c.map((function(e){var t,n=Object.values(null!=(t=null==a||null==a.participants?void 0:a.participants())?t:{}).find((function(t){return t.session_id===e}));if(n)return{local:n.local,screenAudio:n.tracks.screenAudio,screenVideo:n.tracks.screenVideo,screenId:e+"-screen",session_id:e}})).filter((function(e){return!!e}))}),[a,c]);return{isSharingScreen:l.some((function(e){return e.local})),screens:l,startScreenShare:u,stopScreenShare:o}},exports.useScreenVideoTrack=function(e){return w(e,"screenVideo")},exports.useThrottledDailyEvent=m,exports.useVideoTrack=function(e){return w(e,"video")},exports.useWaitingParticipants=function(e){var t=void 0===e?{}:e,r=t.onWaitingParticipantAdded,a=t.onWaitingParticipantRemoved,u=t.onWaitingParticipantUpdated,o=f(),c=i.useRecoilValue(G),l=i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){var n=t.set;n(J,(function(t){return t.includes(e.participant.id)?t:[].concat(t,[e.participant.id])})),n($(e.participant.id),e.participant)})),setTimeout((function(){return null==r?void 0:r(e)}),0)}}),[r]),s=i.useRecoilCallback((function(e){var t=e.transact_UNSTABLE;return function(e){t((function(t){var n=t.reset;(0,t.set)(J,(function(t){return t.filter((function(t){return t!==e.participant.id}))})),n($(e.participant.id))})),setTimeout((function(){return null==a?void 0:a(e)}),0)}}),[a]),d=i.useRecoilCallback((function(e){var t=e.set;return function(e){t($(e.participant.id),e.participant),setTimeout((function(){return null==u?void 0:u(e)}),0)}}),[u]);g("waiting-participant-added",l),g("waiting-participant-removed",s),g("waiting-participant-updated",d);var v=n.useCallback((function(e,t){"*"!==e?null==o||o.updateWaitingParticipant(e,{grantRequestedAccess:t}):null==o||o.updateWaitingParticipants({"*":{grantRequestedAccess:t}})}),[o]);return{waitingParticipants:c,grantAccess:n.useCallback((function(e){v(e,!0)}),[v]),denyAccess:n.useCallback((function(e){v(e,!1)}),[v])}};
//# sourceMappingURL=daily-react-hooks.cjs.production.min.js.map
